---
title: '자바스크립트 코드를 줄이기 위한 HTML, CSS 기법'
tags:
  - html
  - css
  - javascript
published: false
date: 2021-04-27 16:44:25
description: '입적화만 몇 달째'
---

점점더 많은 웹사이트들이 유저와의 인터랙션을 위해서 자바스크립트에 의존하고 있다. 이걸로 빌어먹고 사는 나로서는 더없이 좋은 일이지만, 이따금씩 사이트가 올바르지 않게 동작하는 경우도 있다.

- 웹 사이트 로딩 시간이 느려지거나
- 자바스크립트가 실행 중에 페이지에 암것도 안보이거나
- 사용성, 반응성, 접근성 등이 부족한 경우

이번 글에서는, 이런 경우에 대부분의 개발자가 사용할 수 있는 몇가지 간단한 솔루션에 대해 살펴보고자 한다.

## 자바스크립트는 렌더링을 블록한다 (다섯번째 얘기 중)

브라우저는 페이지의 렌더링을 제어하는 스레드가 단 하나다. 자바스크립트가 실행 된다면, 브라우저는 사용자 인터렉션을 그 동안 지연시키게 된다. 이 자바스크립트 실행이 길어진다면 페이지가 사용자의 작업에 응답하지 않거나, 동작이 지저분하다는 인상을 줄 수 있다. 

개발자는 파워풀한 장비로 개발 하기 때문에, 이러한 것을 느끼지 못하는 경우가 많다. 일반적인 장비에서 자주 테스트 하고, 그리고 개발자들도 크롬의 performacne 탭에서 쓰로틀링을 주면서 개발을 해봐야 한다.

## 화면에 노출되는 글자 줄이기

### 자바스크립트로 한다면

1. 표시되는 문자의 수를 제한하는 방법. 모노스페이스 폰트의 경우를 제외하고, 글꼴이나 사용자 폰트에 따라서 가변적이기 때문에 매우 어려운 방법이다. 
2. 엘리먼트에 원하는 줄수 만큼 나올 때까지 계속 실험해보면서 글자를 잘라내는 방법. 그러나 이는 매번 렌더링을 시도하면서 원하는 크기를 얻어낼 수 있는지 확인해야 하기 때문에 귀찮다. 이 기법은 원하는 글꼴로 렌더링한 후에 쓰는 경우에만 정확히 계산할 수 있으며, 이로인해 레이아웃이 크게 변할 수 있다.

### CSS 속성 이용하기

[-webkit-line-clamp](https://developer.mozilla.org/en/docs/Web/CSS/-webkit-line-clamp)라는 CSS 속성을 사용하는 방법이 있다. 이는 이름에서 볼 수 있는 것 처럼, 10년전에 사파리에서 소개된 속성인데, 널리 사용되어버리면서 다른 브라우저들도 호환성을 이유로 채택하게 되었고 종국에는 표준이 되었다. 버전 68이전의 파이어폭스와 익스플로러를 제외하고 모든 브라우저가 이 속성을 지원한다.

https://codepen.io/Rik/pen/jOMGVGY

이 방법은 성능이나 콘텐츠 이동 등 귀찮은 이슈가 없고, 검색엔진이나 접근성 기술에도 영향을 미치지 않는다. 그러나, 여러개의 children이 있는 경우에는 정확하게 동작하지 않는다. https://codepen.io/jimratliff/pen/BaBzzbq

## 중요한 요소를 화면에 유지하기

화면의 헤더나 장바구니와 같이 중요한 요소를 페이지에서 계속 고정해서 보여주고 싶은 경우가 있다. 이러한 UI는 매우 자주 보지만, 제대로 구현해둔 것을 거의 본적이 없다

### 자바스크립트로 한다면

스크롤 이벤트를 감지할 필요가 있다. 스크롤 이벤트는 사용자가 스크롤 할 때 마다 계속 날라오므로, 쓰로틀링이나 디바운싱을 사용해서 이벤트를 줄이곤 한다. 최근에는 `IntersectionObserver`를 활용해서 뷰포트에 특정 요소가 들어오는지 여부를 확인한다.

`IntersectionObserver`로 뷰포트에 진입하거나 떠난 것을 감지했다면, 해당 요소를 `position: relative`에서 `position: fixed`로 바꾼다. 이는 브라우저가 사이즈를 재계산하고 많은 요소들의 위치를 수정해야 하기 때문에 굉장히 비싼 작업이다. 그리고 이러한 변경으로 인해, 그 주변에 있는 요소들이 움직여서는 안된다.

### `position: sticky`

[position: sticky](https://developer.mozilla.org/en/docs/Web/CSS/position)를 활용해보자. 성능 이나 반응 이슈, 컨텐츠의 움직임 또한 없다. 웹페이지가 스크롤 되는 동안, 아이템은 정확히 선언된 곳에 유지되어 있는다. `top` `bottom` `left` `right`로 위치를 지정할 수 있다. 그러나 아쉽게도(?) 익스플로러와 일부 구형 브라우저에서는 작동하지 않는다. 그리고 위에 붙어있는 경우와 상단에 있는 경우에 모양을 자유자재로 바꿀 수는 없다. [이는 일반적인 CSS의 제한사항이다.](https://wiki.csswg.org/faq#selectors-that-depend-on-layout) 이 문제를 해결하기 위해서는, `position: sticky`와 `IntersectionObserver` 두개를 같이 사용하는 것이 좋다.

## 부드러운 스크롤 (Smooth scrolling)

### 자바스크립트로 하려면

이 기능을 자바스크립트에서 구현하려면, 스크롤 위치를 변경할 자바스크립트 코드를 정기적으로 실행해야 한다. 애니메이션이 원활하게 실행되도록 하려면, 전체 애니메이션 중에 다른 자바스크립트가 렌더링을 차단해서는 안된다. 또한 timing 함수를 사용해야 한다. 자연스러워 보이면, 각 운영체제의 컨벤션마다 대응을 해야할 수도 있다.

### Smooth

[scroll-behavior:smooth](https://developer.mozilla.org/en/docs/Web/CSS/scroll-behavior)와 `{behavior: 'smooth'}`